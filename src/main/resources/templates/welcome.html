<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Choice Automation</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand" href="/">Deployment Strategy Automation</a>
    <div class="ml-auto">
        <!-- Dynamic connection status with Gorgias Cloud -->
        <span th:if="${userSession.connectionStatus}" class="badge badge-success">
            Connected to Gorgias Cloud <i class="fas fa-check-circle"></i>
        </span>
    </div>
</nav>

<!-- Reset Success Message -->
<div class="container mt-3">
    <div class="alert alert-success alert-dismissible fade show" role="alert" th:if="${message}" id="resetSuccessAlert">
        <i class="fas fa-check-circle"></i> <span th:text="${message}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
</div>

<!-- Main Container -->
<div class="container mt-5">
    <h2 class="display-5 text-center">Cloud Deployment Strategy Assistant</h2>
    <p class="lead text-center">Follow the steps in order to define your cloud deployment strategy.</p>

    <div class="workflow-container">
        
        <!-- Step 1 -->
        <div class="workflow-step">
            <h5><i class="fas fa-exclamation-circle"></i> Set Urgency Level</h5>
            <p>Specify urgency level and agency details.</p>
            <a href="/workflow/index" class="btn btn-primary btn-block" data-toggle="tooltip" title="Define urgency">Define Urgency</a>
            <div><strong>Status:</strong> 
                <span th:text="${urgencyStatus}" th:class="${urgencyStatus == '✅ Completed' ? 'badge badge-success' : 'badge badge-warning'}">⏳ Pending</span>
            </div>
        </div>

        <div class="workflow-arrow">➜</div>

        <!-- Step 2 -->
        <div class="workflow-step">
            <h5><i class="fas fa-server"></i> Choose Infrastructure</h5>
            <p>Select infrastructure needs.</p>
            <a href="/workflow/infrbroadcat" class="btn btn-primary btn-block" data-toggle="tooltip" title="Specify infrastructure">Define Infrastructure</a>
            <div><strong>Status:</strong> 
                <span th:text="${infrastructureStatus}" th:class="${infrastructureStatus == '✅ Completed' ? 'badge badge-success' : 'badge badge-warning'}">⏳ Pending</span>
            </div>
        </div>

        <div class="workflow-arrow">➜</div>

        <!-- Step 3 -->
        <div class="workflow-step">
            <h5><i class="fas fa-map-marker-alt"></i> Select Data Location</h5>
            <p>Define data type and cloud environment.</p>
            <a href="/workflow/location" class="btn btn-primary btn-block" data-toggle="tooltip" title="Choose location">Define Location</a>
            <div><strong>Status:</strong> 
                <span th:text="${locationStatus}" th:class="${locationStatus == '✅ Completed' ? 'badge badge-success' : 'badge badge-warning'}">⏳ Pending</span>
            </div>
        </div>

        <div class="workflow-arrow">➜</div>

        <!-- Step 4 -->
        <div class="workflow-step">
            <h5><i class="fas fa-memory"></i> Define Resources</h5>
            <p>Determine CPU, memory, and storage.</p>
            <a href="/workflow/resource-requirements" class="btn btn-primary btn-block" data-toggle="tooltip" title="Specify computing resources">Define Requirements</a>
            <div><strong>Status:</strong> 
                <span th:text="${resourceStatus}" th:class="${resourceStatus == '✅ Completed' ? 'badge badge-success' : 'badge badge-warning'}">⏳ Pending</span>
            </div>
        </div>

        <div class="workflow-arrow">➜</div>

        <!-- Step 5 -->
        <div class="workflow-step">
            <h5><i class="fas fa-chart-line"></i> Plan Scalability</h5>
            <p>Define scalability for peak loads.</p>
            <a href="/workflow/scalability-performance" class="btn btn-primary btn-block" data-toggle="tooltip" title="Define scalability">Define Scalability</a>
            <div><strong>Status:</strong> 
                <span th:text="${scalabilityStatus}" th:class="${scalabilityStatus == '✅ Completed' ? 'badge badge-success' : 'badge badge-warning'}">⏳ Pending</span>
            </div>
        </div>

        <div class="workflow-arrow">➜</div>

        <!-- Final Step -->
        <div class="workflow-step" style="background: #28a745; color: white;">
            <h5><i class="fas fa-check-circle"></i> Final Decision</h5>
            <p>Analyze all selections before finalizing.</p>
            <a href="/workflow/combined-decision-result" class="btn btn-light btn-block" data-toggle="tooltip" title="Review final selections">View Final Decision</a>
        </div>
    </div>
</div>

<!-- Reset Button (triggers modal) -->
<div class="reset-container">
    <button type="button" class="btn btn-warning reset-btn" data-toggle="modal" data-target="#resetConfirmModal">
        <i class="fas fa-redo"></i> Reset Workflow
    </button>
</div>

<!-- Reset Confirmation Modal -->
<div class="modal fade" id="resetConfirmModal" tabindex="-1" role="dialog" aria-labelledby="resetConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="resetConfirmModalLabel">
                    <i class="fas fa-exclamation-triangle"></i> Confirm Workflow Reset
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="lead">Are you sure you want to reset the entire workflow?</p>
                <div class="alert alert-warning">
                    <strong>This will:</strong>
                    <ul class="mb-0 mt-2">
                        <li>Clear all your selections and decisions</li>
                        <li>Reset all steps to "Pending" status</li>
                        <li>Remove any generated recommendations</li>
                    </ul>
                </div>
                <p><strong>This action cannot be undone.</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <form id="resetForm" action="/workflow/reset-status" method="post">
                    <input type="hidden" name="confirmReset" value="true">
                    <button type="submit" class="btn btn-danger" id="confirmResetBtn">
                        <i class="fas fa-trash-alt"></i> Yes, Reset Everything
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Reset Functionality -->
<script>
    $(document).ready(function(){
        // Enable tooltips
        $('[data-toggle="tooltip"]').tooltip();
        
        // Handle reset form submission with loading state
        $('#resetForm').on('submit', function() {
            const confirmBtn = $('#confirmResetBtn');
            confirmBtn.prop('disabled', true);
            confirmBtn.html('<i class="fas fa-spinner fa-spin"></i> Resetting...');
            
            // Clear browser storage
            localStorage.clear();
            sessionStorage.clear();
            
            // Allow form submission
            return true;
        });
        
        // Auto-dismiss success message after 5 seconds
        setTimeout(function() {
            $('#resetSuccessAlert').alert('close');
        }, 5000);
        
        // Check if we need to clear client-side cache (after reset)
        const resetPerformed = /*[[${resetPerformed}]]*/ false;
        if (resetPerformed) {
            console.log("Reset detected - clearing client-side state");
            
            // Clear any form data that might be cached by the browser
            $('form').each(function() {
                this.reset();
            });
            
            // Clear any custom data attributes
            $('[data-original-value]').removeAttr('data-original-value');
            
            // Remove any dynamic classes
            $('.selected, .active-selection, .completed').removeClass('selected active-selection completed');
        }
    });
</script>

<!-- Footer -->
<footer class="text-center py-4 mt-5" style="background-color: #f8f9fa;">
    <p>&copy; 2024 Technical University of Crete. All Rights Reserved. <br>
       Developed as part of a research thesis in <strong>Cloud Deployment Strategy Decision System Using Argumentation</strong>.
    </p>
</footer>

<style>
    /* Enhance reset button styling */
    .reset-container {
        text-align: center;
        margin-top: 30px;
    }
    
    .reset-btn {
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
    }
    
    .reset-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    /* Modal animation */
    .modal.fade .modal-dialog {
        transition: transform 0.3s ease-out;
        transform: translate(0, -50px);
    }
    
    .modal.show .modal-dialog {
        transform: none;
    }
    
    /* Success alert styling */
    .alert-success {
        border-left: 4px solid #28a745;
    }
</style>

</body>
</html>